<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katsee</title>
    <link rel="stylesheet" type="text/css" href="/user/UserHome.css">
</head>
<body>
    <div class="container" id="container">
        <div class="header">
            <div class="logo">í™ˆ</div>
            <div class="greeting">ë°˜ê°€ì›Œìš”, <span id="name">ê¹€ê²½ë¯¼</span> ë‹˜! ğŸ‰</div>
            <a href="#" class="notification" onclick="notice()">
                <img src="/images/Bell.png" alt="bell" class="bell-icon">
            </a>
        </div>

        <div class="matches-section">
            <div class="matches-title">ë§¤ì¹­ í˜„í™© í†µê³„</div>
            <div class="matches-stats">
                <div class="stats-box">
                    <div class="stats-label">ì „ì²´ ë§¤ì¹­</div>
                    <div class="stats-value" id="stats-value">0ê±´</div>
                </div>
                <div class="stats-box">
                    <div class="stats-label">ì‹ ê·œ ë§¤ì¹­</div>
                    <div class="stats-value blue-text" id="blue-text">0ê±´</div>
                </div>
            </div>
            <div class="button-row">
                <div class="action-button button-blue" id="button-blue">ìš”ì²­ ëŒ€ê¸° 0ê±´</div>
                <div class="action-button button-green" id="button-green">ì¹œêµ¬ ë§ºê¸° 0ê±´</div>
                <div class="action-button button-red" id="button-red">ê±°ì ˆ 0ê±´</div>
            </div>
        </div>

        <div class="section-title">ì§€ê¸ˆ ê°€ì¥ í•«í•œ ê´€ì‹¬ì‚¬ íƒ‘ 3</div>
        <div class="tag-div">
            <span class="tag"># ìŒì•…</span>
            <span class="tag"># IT</span>
            <span class="tag"># ë§›ì§‘ íƒë°©</span>
        </div>

        <div class="section-title">ì´ë²ˆ ì£¼ ì¸ê¸° ê´€ì‹¬ì‚¬</div>
        <div class="tag-div">
            <span class="tag"># ìŒì•…</span>
            <span class="tag"># IT</span>
            <span class="tag"># ë§›ì§‘ íƒë°©</span>
        </div>

        <div class="section-title">ê´€ì‹¬ì‚¬ì™€ ìƒê´€ì—†ëŠ” ì¹œêµ¬ ì¶”ì²œ</div>
        <div id="card"></div>

        <div class="navigation">
            <a href="/FriendRecommend.html" class="nav-item">
                <img src="/images/Friends.png" alt="" class="icon">
                ì¹œêµ¬ ì¶”ì²œ
            </a>
            <a href="/RequestList.html" class="nav-item">
                <img src="images/Love.png" alt="" class="icon">
                ì¹œêµ¬ ìš”ì²­
            </a>
            <a href="/" class="nav-item active">
                <img src="/images/home1.png" alt="" class="icon">
                í™ˆ
            </a>
            <a href="/ChattingList.html" class="nav-item">
                <img src="/images/Chat.png" alt="" class="icon">
                ì±„íŒ…
            </a>
            <a href="/my" class="nav-item">
                <img src="/images/User.png" alt="" class="icon">
                ë§ˆì´í˜ì´ì§€
            </a>
        </div>
    </div>

    <script>
        const token = window.localStorage.getItem('AT');

        getMatchData();
        async function getMatchData() {
            const fullStatistics = document.getElementById('stats-value');
            const newStatistics = document.getElementById('blue-text');
            const atmosphere = document.getElementById('button-blue');
            const friend = document.getElementById('button-green');
            const refusal = document.getElementById('button-red');

            /**
             * @TODO ë§¤ì¹­ í˜„í™© ê´€ë ¨ API í˜¸ì¶œ
             */
            fetch('/matching/statistics', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            }).then(response => response.json()).then(data => {
                console.log(data);
                fullStatistics.textContent = data.result.fullStatistics;
                newStatistics.textContent = data.result.newStatistics;
            }).catch(error => console.log(error));

            fetch('/matching/statistics/status', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            }).then(response => response.json()).then(data => {
                console.log(data);
                atmosphere.textContent = `ìš”ì²­ ëŒ€ê¸° ${data.result.atmosphere}ê±´`;
                friend.textContent = `ì¹œêµ¬ ë§ºê¸° ${data.result.friend}ê±´`;
                refusal.textContent = `ê±°ì ˆ ${data.result.refusal}ê±´`;
            }).catch(error => console.log(error));
        }

        let interest = '';
        let memberInfor = null;
        member();
        async function member() {
            /**
             * @TODO íšŒì› ê¸°ë³¸ ì •ë³´ ì¡°íšŒ API í˜¸ì¶œ
             */
            await fetch('/member', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            }).then(response => response.json()).then(date => {
                console.log(date);
                memberInfor = date.result;
                const nickName = document.getElementById('name');
                nickName.textContent = memberInfor.nickName;
            }).catch(error => console.log(error));
        }

        let memberDataList = [];
        memberDatas();
        const container = document.getElementById('container');
        async function memberDatas() {
            /**
             * @TODO ì¹œêµ¬ ì¡°íšŒ API í˜¸ì¶œ
             */
            await fetch(`/member/all`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            }).then(response => response.json()).then(data => {
                console.log(data.result);

                let interestEnumValue = null;
                let interest = '';
                data.result.forEach(member => {
                    member.interests.forEach((i, number) => {
                        switch (i) {
                            case 'MUSIC':
                                interestEnumValue = 'ìŒì•…';
                                break;
                            case 'GAME':
                                interestEnumValue = 'ê²Œì„';
                                break;
                            case 'MOVIEDRAMA':
                                interestEnumValue = 'ì˜í™”/ë“œë¼ë§ˆ';
                                break;
                            case 'READING':
                                interestEnumValue = 'ë…ì„œ';
                                break;
                            case 'ART':
                                interestEnumValue = 'ì˜ˆìˆ ';
                                break;
                            case 'WORKOUT':
                                interestEnumValue = 'ìš´ë™';
                                break;
                            case 'TRAVEL':
                                interestEnumValue = 'ì—¬í–‰';
                                break;
                            case 'FOODEXPLORATION':
                                interestEnumValue = 'ë§›ì§‘ íƒë°©';
                                break;
                            case 'IT':
                                interestEnumValue = 'IT';
                                break;
                        }
                        if (number !== member.interests.length - 1) interest += `${interestEnumValue}, `;
                        else interest += `${interestEnumValue}`;
                    });

                    memberDataList.push({
                        id: member.memberId,
                        profileUrl: member.profileUrl,
                        nickName: member.nickName,
                        age: member.age,
                        gender: member.gender,
                        introduction: member.introduction,
                        interest: interest,
                    });
                    interest = '';
                });
            }).catch(error => console.log(error));
            setMemberElement();
        }

        function setMemberElement() {
            let count = 0;
            const card = document.getElementById('card');
            memberDataList.forEach((data, number) => {
                const friendCard = document.createElement('div');
                friendCard.className = 'friend-card';

                const profilePicDiv = document.createElement('div');
                profilePicDiv.className = 'profile-pic bear-profile';

                const profileImg = document.createElement('img');
                profileImg.src = data.profileUrl;
                profileImg.alt = 'profile-icon';
                profileImg.id = `profileImage${number}`;
                profilePicDiv.appendChild(profileImg);

                const userInfoDiv = document.createElement('div');
                userInfoDiv.className = 'user-info';

                const userNameDiv = document.createElement('div');
                userNameDiv.className = 'user-name';

                const nameP = document.createElement('p');
                nameP.id = `name${number}`;
                nameP.textContent = data.nickName;

                const genderAgeSpan = document.createElement('span');
                genderAgeSpan.id = `genderAndAge${number}`;
                genderAgeSpan.textContent = `${data.gender} (${data.age})`;

                userNameDiv.appendChild(nameP);
                userNameDiv.appendChild(genderAgeSpan);

                const userBioDiv = document.createElement('div');
                userBioDiv.className = 'user-bio';
                userBioDiv.id = `introduction${number}`;
                userBioDiv.textContent = data.introduction;

                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';

                const interestIcon = document.createElement('img');
                interestIcon.src = '/images/Interest-Icon.png';
                interestIcon.alt = 'interest-icon';

                const interestP = document.createElement('p');
                interestP.className = 'interest';
                interestP.id = `interest${number}`;
                interestP.textContent = data.interest;

                categoryDiv.appendChild(interestIcon);
                categoryDiv.appendChild(interestP);

                userInfoDiv.appendChild(userNameDiv);
                userInfoDiv.appendChild(userBioDiv);
                userInfoDiv.appendChild(categoryDiv);

                const matchButtonDiv = document.createElement('div');
                matchButtonDiv.className = 'match-rate-and-button';

                const detailBtn = document.createElement('button');
                detailBtn.className = 'detail-btn';
                detailBtn.textContent = 'ìƒì„¸ ì •ë³´';
                detailBtn.onclick = function() {
                    location.href = '/FriendDetailsInfor.html';
                };

                matchButtonDiv.appendChild(detailBtn);

                friendCard.appendChild(profilePicDiv);
                friendCard.appendChild(userInfoDiv);
                friendCard.appendChild(matchButtonDiv);
                card.appendChild(friendCard);
                count += 100;
                container.style.height = `calc(100% + ${count}px)`;
            });
        }
        setMemberElement();

        function notice() {
            window.location.href = '/UserNotice.html';
        }
    </script>
</body>
</html>
